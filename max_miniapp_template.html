<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAX Mini App - –ú–∞–≥–∞–∑–∏–Ω –±—Ä–µ–ª–æ–∫–æ–≤</title>
    
     <!-- MAX Bridge SDK (Updated URL according to documentation) -->
     <script src="https://st.max.ru/js/max-web-app.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 16px;
            padding-bottom: 80px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 8px;
        }
        
        .user-info {
            color: #666;
            font-size: 14px;
        }
        
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .product-card:active {
            transform: scale(0.95);
        }
        
        .product-image {
            width: 100%;
            height: 120px;
            background: #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            margin-bottom: 12px;
        }
        
        .product-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }
        
        .product-price {
            color: #4CAF50;
            font-weight: 700;
            font-size: 18px;
        }
        
        .cart {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .cart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-total {
            font-size: 20px;
            font-weight: 700;
            color: #4CAF50;
            margin-top: 12px;
            text-align: right;
        }
        
        .empty-cart {
            text-align: center;
            color: #999;
            padding: 20px;
        }
        
        .status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #4CAF50;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
        }
        
        .status.error {
            background: #f44336;
        }
    </style>
</head>
<body>
    <div id="status" class="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    
    <div class="container">
        <div class="header">
            <h1>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω –±—Ä–µ–ª–æ–∫–æ–≤</h1>
            <div class="user-info" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div class="products" id="products"></div>
        
        <div class="cart">
            <div class="cart-title">üõí –ö–æ—Ä–∑–∏–Ω–∞</div>
            <div id="cartItems" class="empty-cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            <div id="cartTotal" class="cart-total" style="display: none;"></div>
        </div>
    </div>

    <script>
        // =================================================================
        // MAX MINI APP –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // =================================================================
        
        /**
         * –í–ê–ñ–ù–û: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
         * –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ MAX
         * 
         * –û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã:
         * 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MaxBridge
         * 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ MaxBridge.ready()
         * 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ MAX –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ WebApp.ready
         * 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (BackButton, MainButton)
         * 5. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         * 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π (–∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º)
         * 7. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API –±–æ—Ç–∞
         */
        
        // =================================================================
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // =================================================================
        
        let cart = []; // –ö–æ—Ä–∑–∏–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤
        let userData = null; // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ MAX
        let isMaxApp = false; // –§–ª–∞–≥ —Ä–∞–±–æ—Ç—ã –≤ MAX
        
        // –¢–æ–≤–∞—Ä—ã –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
        const products = [
            { id: 1, name: '–ë—Ä–µ–ª–æ–∫ "–°–µ—Ä–¥—Ü–µ"', price: 350, emoji: '‚ù§Ô∏è' },
            { id: 2, name: '–ë—Ä–µ–ª–æ–∫ "–ó–≤–µ–∑–¥–∞"', price: 300, emoji: '‚≠ê' },
            { id: 3, name: '–ë—Ä–µ–ª–æ–∫ "–õ—É–Ω–∞"', price: 400, emoji: 'üåô' },
            { id: 4, name: '–ë—Ä–µ–ª–æ–∫ "–ö–æ—Ç"', price: 450, emoji: 'üê±' },
            { id: 5, name: '–ë—Ä–µ–ª–æ–∫ "–¶–≤–µ—Ç–æ–∫"', price: 320, emoji: 'üå∏' },
            { id: 6, name: '–ë—Ä–µ–ª–æ–∫ "–ö–ª—é—á"', price: 380, emoji: 'üîë' }
        ];
        
        // =================================================================
        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° MAX BRIDGE
        // =================================================================
        
        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ UI
         */
        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = isError ? 'status error' : 'status';
            console.log(`[STATUS] ${message}`);
        }
        
        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MAX Bridge
         */
        async function initMaxBridge() {
            console.log('[INIT] –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ MAX Bridge');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MaxBridge
            if (!window.MaxBridge) {
                console.warn('[INIT] MaxBridge –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - —Ä–∞–±–æ—Ç–∞–µ–º –≤ —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä–∞');
                updateStatus('–†–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞', true);
                isMaxApp = false;
                initBrowserMode();
                return;
            }
            
            try {
                // –®–∞–≥ 1: –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ MaxBridge
                console.log('[INIT] –í—ã–∑–æ–≤ MaxBridge.ready()');
                await MaxBridge.ready();
                console.log('[INIT] MaxBridge –≥–æ—Ç–æ–≤!');
                
                isMaxApp = true;
                updateStatus('MAX –≥–æ—Ç–æ–≤!');
                
                // –®–∞–≥ 2: –£–≤–µ–¥–æ–º–ª—è–µ–º MAX —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
                console.log('[INIT] –û—Ç–ø—Ä–∞–≤–∫–∞ WebApp.ready');
                await MaxBridge.send('WebApp.ready');
                console.log('[INIT] WebApp.ready –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                
                // –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
                console.log('[INIT] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ BackButton');
                await setupBackButton();
                
                // –®–∞–≥ 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                console.log('[INIT] –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                await getUserData();
                
                // –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
                console.log('[INIT] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MainButton');
                await setupMainButton();
                
                console.log('[INIT] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                updateStatus('‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ');
                
                // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    document.getElementById('status').style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('[INIT] –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                updateStatus('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', true);
                isMaxApp = false;
                initBrowserMode();
            }
        }
        
        /**
         * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
         */
        async function setupBackButton() {
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
                await MaxBridge.send('BackButton.show');
                console.log('[BACK] –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –ø–æ–∫–∞–∑–∞–Ω–∞');
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
                MaxBridge.on('BackButton.clicked', async () => {
                    console.log('[BACK] –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–∞–∂–∞—Ç–∞');
                    
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ - —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                    if (cart.length > 0) {
                        try {
                            const confirmed = await MaxBridge.send('showConfirm', {
                                message: '–í –∫–æ—Ä–∑–∏–Ω–µ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã. –ó–∞–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω?'
                            });
                            
                            if (confirmed) {
                                console.log('[BACK] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –∑–∞–∫—Ä—ã—Ç–∏–µ');
                                await MaxBridge.send('WebApp.close');
                            } else {
                                console.log('[BACK] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –∑–∞–∫—Ä—ã—Ç–∏–µ');
                            }
                        } catch (error) {
                            console.error('[BACK] –û—à–∏–±–∫–∞ showConfirm:', error);
                            await MaxBridge.send('WebApp.close');
                        }
                    } else {
                        // –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ - –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º
                        console.log('[BACK] –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞, –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
                        await MaxBridge.send('WebApp.close');
                    }
                });
                
            } catch (error) {
                console.error('[BACK] –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥":', error);
            }
        }
        
        /**
         * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ MAX
         */
        async function getUserData() {
            try {
                userData = await MaxBridge.send('getUserData');
                console.log('[USER] –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–µ–Ω—ã:', userData);
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const userInfoEl = document.getElementById('userInfo');
                if (userData && userData.name) {
                    userInfoEl.textContent = `–ü—Ä–∏–≤–µ—Ç, ${userData.name}! üëã`;
                } else {
                    userInfoEl.textContent = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!';
                }
                
            } catch (error) {
                console.error('[USER] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                document.getElementById('userInfo').textContent = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!';
            }
        }
        
        /**
         * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ (MainButton)
         */
        async function setupMainButton() {
            try {
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞)
                await MaxBridge.send('MainButton.hide');
                console.log('[MAIN] MainButton —Å–∫—Ä—ã—Ç–∞');
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                MaxBridge.on('MainButton.clicked', async () => {
                    console.log('[MAIN] MainButton –Ω–∞–∂–∞—Ç–∞ - –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞');
                    await checkoutOrder();
                });
                
            } catch (error) {
                console.error('[MAIN] –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MainButton:', error);
            }
        }
        
        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
         */
        async function updateMainButton() {
            if (!isMaxApp) return;
            
            try {
                if (cart.length > 0) {
                    const total = cart.reduce((sum, item) => sum + item.price, 0);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å —Å—É–º–º–æ–π –∑–∞–∫–∞–∑–∞
                    await MaxBridge.send('MainButton.show', {
                        text: `–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ (${total} ‚ÇΩ)`,
                        color: '#4CAF50',
                        text_color: '#FFFFFF'
                    });
                    console.log('[MAIN] MainButton –æ–±–Ω–æ–≤–ª–µ–Ω–∞, —Å—É–º–º–∞:', total);
                } else {
                    // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞
                    await MaxBridge.send('MainButton.hide');
                    console.log('[MAIN] MainButton —Å–∫—Ä—ã—Ç–∞ (–∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞)');
                }
            } catch (error) {
                console.error('[MAIN] –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è MainButton:', error);
            }
        }
        
        /**
         * –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
         */
        async function checkoutOrder() {
            if (cart.length === 0) {
                console.warn('[CHECKOUT] –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
                return;
            }
            
            try {
                const total = cart.reduce((sum, item) => sum + item.price, 0);
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
                const orderData = {
                    user_id: userData?.user_id || 'unknown',
                    user_name: userData?.name || '–ì–æ—Å—Ç—å',
                    items: cart,
                    total: total,
                    timestamp: new Date().toISOString()
                };
                
                console.log('[CHECKOUT] –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞:', orderData);
                
                // –ó–î–ï–°–¨ –û–¢–ü–†–ê–í–ö–ê –ó–ê–ö–ê–ó–ê –ù–ê –í–ê–® –°–ï–†–í–ï–†
                // –ü—Ä–∏–º–µ—Ä:
                /*
                const response = await fetch('https://your-backend.com/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                
                const result = await response.json();
                console.log('[CHECKOUT] –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
                */
                
                // –î–ª—è –¥–µ–º–æ - –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª–µ—Ä—Ç
                if (isMaxApp) {
                    await MaxBridge.send('showAlert', {
                        message: `‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω –Ω–∞ —Å—É–º–º—É ${total} ‚ÇΩ!\n\n–¢–æ–≤–∞—Ä—ã:\n${cart.map(item => `‚Ä¢ ${item.name}`).join('\n')}`
                    });
                } else {
                    alert(`‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω –Ω–∞ —Å—É–º–º—É ${total} ‚ÇΩ!`);
                }
                
                // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
                cart = [];
                updateCart();
                updateMainButton();
                
                console.log('[CHECKOUT] –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω');
                
            } catch (error) {
                console.error('[CHECKOUT] –û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞:', error);
                
                if (isMaxApp) {
                    await MaxBridge.send('showAlert', {
                        message: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.'
                    });
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞');
                }
            }
        }
        
        /**
         * –†–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞ (–∫–æ–≥–¥–∞ MAX –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
         */
        function initBrowserMode() {
            console.log('[BROWSER] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞ –±—Ä–∞—É–∑–µ—Ä–∞');
            document.getElementById('userInfo').textContent = '–†–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–±—Ä–∞—É–∑–µ—Ä)';
            
            // –í —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–µ alert/confirm
            window.MaxBridge = {
                send: (method, params) => {
                    console.log('[BROWSER MOCK]', method, params);
                    return Promise.resolve(true);
                },
                on: (event, handler) => {
                    console.log('[BROWSER MOCK] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:', event);
                }
            };
        }
        
        // =================================================================
        // –§–£–ù–ö–¶–ò–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø (UI –õ–û–ì–ò–ö–ê)
        // =================================================================
        
        /**
         * –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
         */
        function renderProducts() {
            const productsEl = document.getElementById('products');
            productsEl.innerHTML = products.map(product => `
                <div class="product-card" onclick="addToCart(${product.id})">
                    <div class="product-image">${product.emoji}</div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${product.price} ‚ÇΩ</div>
                </div>
            `).join('');
        }
        
        /**
         * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
         */
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                cart.push({...product});
                console.log('[CART] –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω:', product);
                updateCart();
                updateMainButton();
            }
        }
        
        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã
         */
        function updateCart() {
            const cartItemsEl = document.getElementById('cartItems');
            const cartTotalEl = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartItemsEl.innerHTML = '<div class="empty-cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
                cartTotalEl.style.display = 'none';
            } else {
                const itemsHtml = cart.map((item, index) => `
                    <div class="cart-item">
                        <span>${item.emoji} ${item.name}</span>
                        <span>${item.price} ‚ÇΩ</span>
                    </div>
                `).join('');
                
                const total = cart.reduce((sum, item) => sum + item.price, 0);
                
                cartItemsEl.innerHTML = itemsHtml;
                cartTotalEl.textContent = `–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ`;
                cartTotalEl.style.display = 'block';
            }
        }
        
        // =================================================================
        // –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // =================================================================
        
        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
         */
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('[APP] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
            
            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–æ–≤–∞—Ä—ã
            renderProducts();
            updateCart();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º MAX Bridge
            await initMaxBridge();
            
            console.log('[APP] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ');
        });
        
        // =================================================================
        // –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö
        // =================================================================
        
        window.addEventListener('error', (event) => {
            console.error('[ERROR] –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', event.error);
            updateStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', true);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.error('[ERROR] –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π Promise:', event.reason);
        });
        
        // =================================================================
        // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´ MAX BRIDGE (–°–ü–†–ê–í–û–ß–ù–ò–ö)
        // =================================================================
        
        /*
        
        –û–°–ù–û–í–ù–´–ï –ú–ï–¢–û–î–´ MAX BRIDGE:
        
        1. MaxBridge.ready()
           - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è bridge, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise
           - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –ø–µ—Ä–≤—ã–º
        
        2. MaxBridge.send(method, params)
           - –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –≤ MAX
           - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
        
        3. MaxBridge.on(event, handler)
           - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –æ—Ç MAX
           - handler - —Ñ—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        
        –ö–û–ú–ê–ù–î–´ (—á–µ—Ä–µ–∑ send):
        
        - 'WebApp.ready' - —É–≤–µ–¥–æ–º–∏—Ç—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
        - 'WebApp.close' - –∑–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        - 'BackButton.show' - –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
        - 'BackButton.hide' - —Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
        - 'MainButton.show' - –ø–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        - 'MainButton.hide' - —Å–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        - 'showAlert' - –ø–æ–∫–∞–∑–∞—Ç—å alert
        - 'showConfirm' - –ø–æ–∫–∞–∑–∞—Ç—å confirm
        - 'getUserData' - –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        
        –°–û–ë–´–¢–ò–Ø (—á–µ—Ä–µ–∑ on):
        
        - 'BackButton.clicked' - –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
        - 'MainButton.clicked' - –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        
        –ü–ê–†–ê–ú–ï–¢–†–´ MainButton.show:
        {
            text: '–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏',
            color: '#4CAF50',      // –¶–≤–µ—Ç —Ñ–æ–Ω–∞
            text_color: '#FFFFFF'  // –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
        }
        
        –ü–ê–†–ê–ú–ï–¢–†–´ showAlert:
        {
            message: '–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è'
        }
        
        –ü–ê–†–ê–ú–ï–¢–†–´ showConfirm:
        {
            message: '–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞'
        }
        - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise<boolean> (true –µ—Å–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏)
        
        –î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (getUserData):
        {
            user_id: 123456,
            name: '–ò–º—è –§–∞–º–∏–ª–∏—è',
            first_name: '–ò–º—è',
            last_name: '–§–∞–º–∏–ª–∏—è'
        }
        
        */
        
    </script>
</body>
</html>
