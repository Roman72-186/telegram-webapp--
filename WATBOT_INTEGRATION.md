# ะะฝัะตะณัะฐัะธั Mini App ั WatBot

ะะฝััััะบัะธั ะฟะพะปััะตะฝะธั Telegram ID ะฟะพะปัะทะพะฒะฐัะตะปั ะธ ะทะฐะฟััะบั ััะตะฝะฐัะธะตะฒ ะฒ WatBot.

---

## 1. ะะฐะบ Mini App ะฟะพะปััะฐะตั Telegram ID

ะะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั Mini App ัะตัะตะท Telegram ะฑะพัะฐ, Telegram ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะดะฐัั ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั:

```javascript
// telegram.js - ะธะฝะธัะธะฐะปะธะทะฐัะธั
this.tg = window.Telegram?.WebApp;
this.user = this.tg.initDataUnsafe?.user;

// ะะพะปััะตะฝะธะต ID
getUserId() {
    return this.user?.id;  // ะฝะฐะฟัะธะผะตั: 123456789
}
```

**Telegram ะฟะตัะตะดะฐัั ะพะฑัะตะบั user:**
```javascript
{
    id: 123456789,           // โ Telegram ID ะฟะพะปัะทะพะฒะฐัะตะปั
    first_name: "ะะฒะฐะฝ",
    last_name: "ะะตััะพะฒ",
    username: "ivanpetrov",
    language_code: "ru"
}
```

---

## 2. ะะฐะบ ID ะพัะฟัะฐะฒะปัะตััั ะฒ WatBot

ะัะธ ะพัะพัะผะปะตะฝะธะธ ะทะฐะบะฐะทะฐ Mini App ะพัะฟัะฐะฒะปัะตั POST-ะทะฐะฟัะพั ะฝะฐ ะฒะตะฑััะบ:

```javascript
// app.js - ััะฝะบัะธั sendToWatBot()
fetch(CONFIG.WEBHOOK_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        contact_by: 'phone',           // โ ะัะบะฐัั ะฟะพ ะฝะพะผะตัั ัะตะปะตัะพะฝะฐ
        search: '+79991234567',        // โ ะะพะผะตั ัะตะปะตัะพะฝะฐ ะบะปะธะตะฝัะฐ
        variables: {
            order_id: 'ORD-1706620800000',
            customer_name: 'ะะฒะฐะฝ ะะตััะพะฒ',
            // ... ะพััะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต
        }
    })
})
```

---

## 3. ะะฐัััะพะนะบะฐ WatBot ะดะปั ะฟัะธัะผะฐ ะทะฐะบะฐะทะพะฒ

### ะจะฐะณ 1: ะกะพะทะดะฐะนัะต ะฑะพัะฐ ะดะปั ัะตะณะธัััะฐัะธะธ ะบะพะฝัะฐะบัะพะฒ

ะะพะปัะทะพะฒะฐัะตะปั **ะดะพะปะถะตะฝ ัะฝะฐัะฐะปะฐ ะฝะฐะฟะธัะฐัั ะฑะพัั**, ััะพะฑั WatBot ัะพะทะดะฐะป ะบะพะฝัะฐะบั ั ะตะณะพ `telegram_id`.

```
ะะพะปัะทะพะฒะฐัะตะปั โ ะะธัะตั /start ะฑะพัั โ WatBot ัะพะทะดะฐัั ะบะพะฝัะฐะบั ั telegram_id
```

### ะจะฐะณ 2: ะะฐัััะพะนัะต Webhook ะฒ WatBot

1. ะะตัะตะนะดะธัะต ะฒ **WatBot โ ะะฐัััะพะนะบะธ โ Webhooks**
2. ะกะพะทะดะฐะนัะต **Webhook**
3. ะกะบะพะฟะธััะนัะต URL: `https://api.watbot.ru/hook/4325587:oAbD2q949K3SGmOKvZXF2gjtO4d1LHrTnHNWX4T2h8dB6DO8`

### ะจะฐะณ 3: ะัะฐะฒะธะปัะฝะพะต ะฟะพะดะบะปััะตะฝะธะต MAX Bridge SDK

ะะปั ะบะพััะตะบัะฝะพะน ัะฐะฑะพัั ะฟัะธะปะพะถะตะฝะธั ะฒ ะผะตััะตะฝะดะถะตัะต Max, ะธัะฟะพะปัะทัะนัะต ัะปะตะดัััะธะน URL ะดะปั ะฟะพะดะบะปััะตะฝะธั SDK:

```html
<script src="https://st.max.ru/js/max-web-app.js"></script>
```

ะญัะพ ะบัะธัะธัะตัะบะธ ะฒะฐะถะฝะพ, ัะฐะบ ะบะฐะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฝะตะฟัะฐะฒะธะปัะฝะพะณะพ URL ะผะพะถะตั ะฟัะธะฒะตััะธ ะบ ัะพะผั, ััะพ ะผะตัะพะดั `WebApp` ะฝะต ะฑัะดัั ะฝะฐะนะดะตะฝั.

### ะจะฐะณ 3: ะกะพะทะดะฐะนัะต ััะตะฝะฐัะธะน ะพะฑัะฐะฑะพัะบะธ ะทะฐะบะฐะทะฐ

ะ WatBot ัะพะทะดะฐะนัะต ััะตะฝะฐัะธะน, ะบะพัะพััะน:

```
ะขัะธะณะณะตั: Webhook (ะฒะฐั webhook)
    โ
ะะตะนััะฒะธะต: ะัะฟัะฐะฒะธัั ัะพะพะฑัะตะฝะธะต ะฒ Telegram
    ะขะตะบัั: "ะะพะฒัะน ะทะฐะบะฐะท โ{{order_id}}
           ะะปะธะตะฝั: {{customer_name}}
           ะขะตะปะตัะพะฝ: {{customer_phone}}
           ะกัะผะผะฐ: {{order_total}} โฝ
           ะะดัะตั: {{delivery_city}}, {{delivery_address}}"
    โ
ะะตะนััะฒะธะต: ะฃััะฐะฝะพะฒะธัั ัะตะณ "ะะพะฒัะน ะทะฐะบะฐะท"
    โ
ะะตะนััะฒะธะต: ะฃะฒะตะดะพะผะธัั ะผะตะฝะตะดะถะตัะฐ
```

---

## 4. ะกัะตะผะฐ ัะฐะฑะพัั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         ะะะะฌะะะะะขะะะฌ                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  1. ะัะบััะฒะฐะตั Mini App ัะตัะตะท ะบะฝะพะฟะบั ะฒ ะฑะพัะต                      โ
โ     Telegram ะฟะตัะตะดะฐัั: { user: { id: 123456789, ... } }         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  2. Mini App (keychain-shop)                                    โ
โ     - ะะพะปััะฐะตั telegram_id ะธะท window.Telegram.WebApp            โ
โ     - ะะพะปัะทะพะฒะฐัะตะปั ะพัะพัะผะปัะตั ะทะฐะบะฐะท                              โ
โ     - ะัะฟัะฐะฒะปัะตั POST ะฝะฐ /api/webhook                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  3. Vercel (ะฟัะพะบัะธ)                                             โ
โ     - ะะพะปััะฐะตั ะทะฐะฟัะพั ะพั Mini App                               โ
โ     - ะะตัะตะฝะฐะฟัะฐะฒะปัะตั ะฝะฐ WatBot webhook                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  4. WatBot                                                     โ
โ     - ะะพะปััะฐะตั: { contact_by: 'telegram_id', search: '123...' } โ
โ     - ะัะตั ะบะพะฝัะฐะบั ั telegram_id = 123456789                    โ
โ     - ะะฐะฟะธััะฒะฐะตั ะฟะตัะตะผะตะฝะฝัะต ะฒ ะบะฐััะพัะบั ะบะพะฝัะฐะบัะฐ                 โ
โ     - ะะฐะฟััะบะฐะตั ััะตะฝะฐัะธะน (ะพัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธะน, ัะตะณะธ, ะธ ั.ะด.)     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 5. ะะฐะถะฝะพ: ะฃัะปะพะฒะธะต ัะฐะฑะพัั

**ะะพะฝัะฐะบั ะดะพะปะถะตะฝ ัััะตััะฒะพะฒะฐัั ะฒ WatBot ะดะพ ะพัะพัะผะปะตะฝะธั ะทะฐะบะฐะทะฐ!**

ะะพะปัะทะพะฒะฐัะตะปั ะดะพะปะถะตะฝ ัะฝะฐัะฐะปะฐ:
1. ะะฐะฟะธัะฐัั `/start` ะฒะฐัะตะผั Telegram ะฑะพัั
2. WatBot ัะพะทะดะฐัั ะบะพะฝัะฐะบั ั ะตะณะพ `telegram_id`
3. ะขะพะปัะบะพ ะฟะพัะปะต ััะพะณะพ Mini App ัะผะพะถะตั ะฝะฐะนัะธ ะบะพะฝัะฐะบั ะฟะพ ID

---

## 6. ะะพัััะฟะฝัะต ะฟะตัะตะผะตะฝะฝัะต ะฒ WatBot

ะะพัะปะต ะฟะพะปััะตะฝะธั webhook, ะฒ ะบะฐััะพัะบะต ะบะพะฝัะฐะบัะฐ ะฑัะดัั ะดะพัััะฟะฝั:

| ะะตัะตะผะตะฝะฝะฐั | ะัะธะผะตั ะทะฝะฐัะตะฝะธั |
|------------|-----------------|
| `{{order_id}}` | ORD-1706620800000 |
| `{{order_total}}` | 1980 |
| `{{order_subtotal}}` | 1980 |
| `{{order_delivery}}` | 0 |
| `{{order_items_count}}` | 2 |
| `{{order_items}}` | JSON ั ัะพะฒะฐัะฐะผะธ |
| `{{customer_name}}` | ะะฒะฐะฝ ะะตััะพะฒ |
| `{{customer_phone}}` | +7 (999) 123-45-67 |
| `{{customer_email}}` | ivan@example.com |
| `{{delivery_city}}` | ะะพัะบะฒะฐ |
| `{{delivery_address}}` | ัะป. ะััะบะธะฝะฐ, ะด. 10 |
| `{{order_comment}}` | ะะพะผะผะตะฝัะฐัะธะน |
| `{{telegram_user_name}}` | ะะฒะฐะฝ ะะตััะพะฒ |

---

## 7. ะัะธะผะตั ะฟะพะปะฝะพะณะพ JSON ะทะฐะฟัะพัะฐ

```json
{
  "contact_by": "phone",
  "search": "+79991234567",
  "variables": {
    "order_id": "ORD-1706620800000",
    "order_total": "1980",
    "order_subtotal": "1980",
    "order_delivery": "0",
    "order_items_count": "2",
    "order_timestamp": "2026-01-30T12:00:00.000Z",

    "order_items": "[{\"name\":\"ะัะตะปะพะบ Premium Edition\",\"quantity\":2,\"price\":990,\"total\":1980}]",

    "customer_name": "ะะฒะฐะฝ ะะตััะพะฒ",
    "customer_phone": "+7 (999) 123-45-67",
    "customer_email": "ivan@example.com",

    "delivery_city": "ะะพัะบะฒะฐ",
    "delivery_address": "ัะป. ะััะบะธะฝะฐ, ะด. 10, ะบะฒ. 5",

    "order_comment": "ะะพะทะฒะพะฝะธัั ะฟะตัะตะด ะดะพััะฐะฒะบะพะน",

    "source": "mini_app_keychain_shop",
    "telegram_user_name": "ะะฒะฐะฝ ะะตััะพะฒ"
  }
}
```

---

## 8. ะคะฐะนะปั ะฟัะพะตะบัะฐ

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `js/telegram.js` | ะะพะปััะตะฝะธะต ะดะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปั ะธะท Telegram Web App API |
| `js/app.js` | ะะพะณะธะบะฐ ะพัะพัะผะปะตะฝะธั ะทะฐะบะฐะทะฐ ะธ ะพัะฟัะฐะฒะบะธ ะฒ WatBot |
| `js/config.js` | ะะพะฝัะธะณััะฐัะธั (WEBHOOK_URL, ะดะฐะฝะฝัะต ัะพะฒะฐัะฐ) |
| `index.html` | ะัะฝะพะฒะฝะพะน ัะฐะนะป ะฟัะธะปะพะถะตะฝะธั ั ะฟัะฐะฒะธะปัะฝัะผ ะฟะพะดะบะปััะตะฝะธะตะผ MAX Bridge SDK |
| `vercel.json` | ะะฐัััะพะนะบะฐ ะฟัะพะบัะธ ะดะปั ะพะฑัะพะดะฐ CORS |

---

## 9. ะัะปะฐะดะบะฐ

### ะัะพะฒะตัะบะฐ Telegram ID ะฒ ะบะพะฝัะพะปะธ ะฑัะฐัะทะตัะฐ

ะัะบัะพะนัะต Mini App ะธ ะฒ ะบะพะฝัะพะปะธ ัะฐะทัะฐะฑะพััะธะบะฐ ะฒัะฟะพะปะฝะธัะต:

```javascript
console.log(telegramApp.getUserId());
console.log(telegramApp.getUser());
```

### ะัะพะฒะตัะบะฐ ะพัะฟัะฐะฒะบะธ ะทะฐะบะฐะทะฐ

ะ ะบะพะฝัะพะปะธ ะฑัะฐัะทะตัะฐ ะฟัะธ ะพัะพัะผะปะตะฝะธะธ ะทะฐะบะฐะทะฐ ะฒั ัะฒะธะดะธัะต:

```
๐ค ะัะฟัะฐะฒะบะฐ ะทะฐะบะฐะทะฐ: { customer: {...}, order: {...}, telegram: {...} }
โ ะะฐะบะฐะท ััะฟะตัะฝะพ ะพัะฟัะฐะฒะปะตะฝ ะฒ WatBot
```

### ะะตะถะธะผ ัะฐะทัะฐะฑะพัะบะธ

ะะปั ัะตััะธัะพะฒะฐะฝะธั ะฑะตะท Telegram ัััะฐะฝะพะฒะธัะต ะฒ `js/config.js`:

```javascript
DEV_MODE: true,
MOCK_USER: {
    id: 123456789,
    first_name: 'Test',
    last_name: 'User'
}