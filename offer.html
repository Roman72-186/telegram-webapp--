<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <!-- MAX Mini App Meta Tags -->
  <meta name="theme-color" content="#3390ec" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <title>Оферта - MAX Mini App</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- MAX Bridge SDK -->
  <script src="https://apps.max.ru/static/bridge.js"></script>

  <style>
    :root{
      --max-theme-bg-color:#ffffff;
      --max-theme-text-color:#000000;
      --max-theme-hint-color:#999999;
      --max-theme-link-color:#3390ec;
      --max-theme-button-color:#3390ec;
      --max-theme-button-text-color:#ffffff;
      --max-theme-secondary-bg-color:#f1f1f1;
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
      background:var(--max-theme-bg-color);
      color:var(--max-theme-text-color);
    }
    .max-button{
      background:var(--max-theme-button-color);
      color:var(--max-theme-button-text-color);
      cursor:pointer;
      pointer-events:auto;
    }
    .max-button:hover{ opacity:.9; }
    .max-button:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    .back-button {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
    }
    .document-content {
      padding-top: 20px;
    }
    .document-content.with-back-button {
      padding-top: 60px;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">
  <main id="mainContent" class="flex-1 max-w-2xl mx-auto w-full px-4 py-8 document-content">
    <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
      <h1 class="text-2xl font-bold text-gray-900 mb-6">Оферта</h1>
      <div class="text-sm text-gray-600 space-y-2">
        <p>Настоящая публичная оферта (далее — «Оферта») определяет условия использования сервиса.</p>
        <p>Используя наш сервис, вы соглашаетесь с условиями данной оферты.</p>
        <p>Мы оставляем за собой право изменять условия оферты в любое время без предварительного уведомления.</p>
        <p>Все изменения вступают в силу с момента публикации на данной странице.</p>
        <p>При возникновении споров стороны обязуются решать их путем переговоров.</p>
      </div>
    </div>
  </main>

  <script>
    // ===== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ =====
    let isMaxApp = false;

    // ===== ФУНКЦИЯ ВОЗВРАТА =====
    function goBack() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = 'index.html';
      }
    }

    // ===== MAX BRIDGE ИНИЦИАЛИЗАЦИЯ =====
    async function initMaxBridge() {
      console.log('[INIT] Начало инициализации MAX Bridge');

      if (!window.MaxBridge) {
        console.warn('[INIT] MaxBridge недоступен - работаем в режиме браузера');
        isMaxApp = false;
        initBrowserMode();
        return;
      }

      try {
        await MaxBridge.ready();
        console.log('[INIT] MaxBridge готов!');

        isMaxApp = true;

        await MaxBridge.send('WebApp.ready');
        console.log('[INIT] WebApp.ready отправлен');

        await setupBackButton();

        console.log('[INIT] Инициализация завершена');

      } catch (error) {
        console.error('[INIT] Ошибка инициализации:', error);
        isMaxApp = false;
        initBrowserMode();
      }
    }

    // ===== НАСТРОЙКА КНОПКИ "НАЗАД" =====
    async function setupBackButton() {
      try {
        await MaxBridge.send('BackButton.show');
        console.log('[BACK] Кнопка "Назад" показана');

        MaxBridge.on('BackButton.clicked', () => {
          console.log('[BACK] Кнопка "Назад" нажата');
          goBack();
        });

      } catch (error) {
        console.error('[BACK] Ошибка настройки кнопки "Назад":', error);
      }
    }

    // ===== РЕЖИМ БРАУЗЕРА (FALLBACK) =====
    function initBrowserMode() {
      console.log('[BROWSER] Инициализация режима браузера');

      const backButtonHtml = `
        <div class="back-button">
          <button onclick="goBack()" class="max-button py-2 px-4 rounded-lg font-semibold">← Назад</button>
        </div>
      `;
      document.body.insertAdjacentHTML('afterbegin', backButtonHtml);

      document.getElementById('mainContent').classList.add('with-back-button');
    }

    // ===== ЗАПУСК =====
    window.addEventListener('DOMContentLoaded', async () => {
      console.log('[APP] Страница загружена');
      await initMaxBridge();
    });

    // ===== ОБРАБОТКА ОШИБОК =====
    window.addEventListener('error', (event) => {
      console.error('[ERROR] Глобальная ошибка:', event.error);
    });

    window.addEventListener('unhandledrejection', (event) => {
      console.error('[ERROR] Необработанный Promise:', event.reason);
    });
  </script>
</body>
</html>
